
@{
    ViewBag.Title = "Index";
}
<div class="page-wrapper">
    <div class="content">
        <div class="row">
            <div class="col-sm-4 col-3">
                <h4 class="page-title">Export Excel</h4>
            </div>
            <div class="col-sm-3">
                <div class="form-group Month">
                    <label>Month</label>
                    <input class="form-control" type="month" id="Month">
                    <span class="error"><i class="fa fa-exclamation-circle"></i>&nbsp; Enter Month</span>
                </div>
            </div>
            <div class="col-sm-8 col-9 text-right m-b-20">
                <button id="Create_salary" class="btn btn-primary float-right btn-rounded">LOAD DATA</button>
                <button id="btnExport" class="btn btn-primary float-right btn-rounded">EXPORT REPORT</button>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="datatable table table-stripped " id="attendance">
                        <thead>
                            <tr>
                                <th class="collapse">Emp_id</th>
                                <th>Name</th>
                                <th class="collapse">Father_Name</th>
                                <th>CNIC</th>
                                <th class="collapse">address</th>
                                <th class="collapse">Phone</th>
                                <th class="collapse">Email</th>
                                <th>Gender</th>
                                <th>Designation</th>
                                <th>EOBI</th>
                                <th class="collapse">Job_type</th>
                                <th class="collapse">Leaves</th>
                                <th class="collapse">Adv. staff</th>
                                <th class="collapse">I.Tax</th>
                                <th class="collapse">Present days</th>
                                <th>Total days</th>
                                <th>Gross Salary</th>
                            </tr>
                        </thead>
                        <tbody id="emp_details">
                            

                        </tbody>
                    </table>
                </div>

            </div>

        </div>

    </div>

</div>


<style>
    .success-message {
        display: none;
    }

    span.error {
        display: none;
        color: #d93025;
        font-size: 80%;
        margin-top: 3px;
    }

    .alert-message {
        display: none;
    }
</style>

<script src="~/Content/assets/js/tableToExcel.js"></script>
<script src="~/Content/assets/js/Jquery3.6.1.js"></script>
<script>
    $(document).ready(function () {


        $('#Create_salary').click(function (e) {
            e.preventDefault();
            var isAllValid = true;

            if (!($('#Month').val().trim() != '')) {
                isAllValid = false;
                $('.Month .error').css('display', 'block');
            }
            else {
                $('.Month .error').css('display', 'none');
            }

            if (isAllValid) {
                $('#Create_salary').prop('disabled', true);

                var data = {
                    id: $('#Employee_list').val(),
                    Month: $('#Month').val(),

                }

                debugger
                $.ajax({
                    type: 'POST',
                    url: '/Excel_Export/ExportToExcel',
                    data: {
                        'Month': data.Month
                    },
                    success: function (resp) {
                        $.each(resp,function(i, item)
                        {
                            $('#emp_details tbody').empty();
                            $('#emp_details').append('<tr><td class="collapse">' + item.Emp_id + '</td>	<td>' + item.Name + '</td>	<td class="collapse">' + item.Father_Name + '</td>	<td>' + item.CNIC + '</td>	<td class="collapse">' + item.address + '</td>	<td class="collapse">' + item.Phone + '</td>	<td class="collapse">' + item.Email + '</td> <td>' + item.Gender + '</td>	<td>' + item.Designation + '</td>	<td>' + item.EOBI + '</td> <td class="collapse">' + item.Job_type + '</td>	<td class="collapse">' + item.Leaves + '</td>	<td class="collapse">' + item.Adv_Staff + '</td>	<td class="collapse">' + item.I_tax + '</td>	<td class="collapse">' + item.get_present_day + '</td>	<td>' + item.total_no_days + '</td>	<td>' + item.Gross_Salary_after_subtrate + '</td> </tr>');
                        })
                    },
                    error: function (ex) {
                        alert('error')
                    }
                });
            }


        });


        $("#btnExport").click(function () {
            let table = document.getElementsByTagName("table");
            TableToExcel.convert(table[0], { // html code may contain multiple tables so here we are refering to 1st table tag
                name: `export.xlsx`, // fileName you could use any name
                sheet: {
                    name: 'Sheet 1' // sheetName
                }
            });
        });
    });
</script>